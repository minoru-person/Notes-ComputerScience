Improve algorithm. Difficult to understand.
